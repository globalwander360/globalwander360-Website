Here is the complete backend structure and full source code for Day 8: Excel Report Generation (Admin) using Spring Boot and Apache POI, with H2 and Liquibase setup:


---

Backend Folder Structure

src/main/java/org/policy/
├── controller/
│   └── ExcelReportController.java
├── service/
│   └── ExcelReportService.java
├── dto/
│   └── ExcelReportDto.java
├── repository/
│   └── InventoryRepository.java
│   └── GoodsReviewRepository.java
├── entity/
│   └── Inventory.java
│   └── GoodsReview.java


---

1. ExcelReportDto.java

package org.policy.dto;

import lombok.AllArgsConstructor;
import lombok.Data;

import java.time.LocalDate;

@Data
@AllArgsConstructor
public class ExcelReportDto {
    private String goodsName;
    private String categoryName;
    private Integer quantity;
    private String warehouseLocation;
    private LocalDate dateAdded;
}


---

2. InventoryRepository.java

package org.policy.repository;

import org.policy.dto.ExcelReportDto;
import org.policy.entity.Inventory;
import org.springframework.data.jpa.repository.Query;
import org.springframework.data.repository.CrudRepository;

import java.util.List;

public interface InventoryRepository extends CrudRepository<Inventory, Long> {

    @Query("SELECT new org.policy.dto.ExcelReportDto(g.name, c.name, i.quantity, i.warehouseLocation, i.dateAdded) " +
           "FROM Inventory i JOIN i.goods g JOIN g.category c")
    List<ExcelReportDto> getInventorySummary();
}


---

3. GoodsReviewRepository.java

package org.policy.repository;

import org.policy.entity.GoodsReview;
import org.springframework.data.jpa.repository.Query;
import org.springframework.data.repository.CrudRepository;

import java.util.List;

public interface GoodsReviewRepository extends CrudRepository<GoodsReview, Long> {

    @Query("SELECT r FROM GoodsReview r WHERE r.status = 'REJECTED'")
    List<GoodsReview> findRejectedGoodsWithComments();
}


---

4. ExcelReportService.java

package org.policy.service;

import lombok.RequiredArgsConstructor;
import org.apache.poi.ss.usermodel.*;
import org.apache.poi.xssf.usermodel.XSSFWorkbook;
import org.policy.dto.ExcelReportDto;
import org.policy.entity.GoodsReview;
import org.policy.repository.GoodsReviewRepository;
import org.policy.repository.InventoryRepository;
import org.springframework.stereotype.Service;

import java.io.ByteArrayInputStream;
import java.io.ByteArrayOutputStream;
import java.util.List;

@Service
@RequiredArgsConstructor
public class ExcelReportService {

    private final InventoryRepository inventoryRepository;
    private final GoodsReviewRepository reviewRepository;

    public ByteArrayInputStream generateExcelReport() throws Exception {
        List<ExcelReportDto> inventoryList = inventoryRepository.getInventorySummary();
        List<GoodsReview> rejectedGoods = reviewRepository.findRejectedGoodsWithComments();

        try (Workbook workbook = new XSSFWorkbook(); ByteArrayOutputStream out = new ByteArrayOutputStream()) {
            // Sheet 1: Inventory Summary
            Sheet summarySheet = workbook.createSheet("Inventory Summary");
            Row headerRow = summarySheet.createRow(0);
            String[] headers = {"Goods Name", "Category", "Quantity", "Warehouse Location", "Date Added"};

            for (int i = 0; i < headers.length; i++) {
                headerRow.createCell(i).setCellValue(headers[i]);
            }

            int rowIdx = 1;
            for (ExcelReportDto item : inventoryList) {
                Row row = summarySheet.createRow(rowIdx++);
                row.createCell(0).setCellValue(item.getGoodsName());
                row.createCell(1).setCellValue(item.getCategoryName());
                row.createCell(2).setCellValue(item.getQuantity());
                row.createCell(3).setCellValue(item.getWarehouseLocation());
                row.createCell(4).setCellValue(item.getDateAdded().toString());
            }

            // Sheet 2: Rejected Goods
            Sheet rejectedSheet = workbook.createSheet("Rejected Goods");
            Row rejectedHeader = rejectedSheet.createRow(0);
            String[] rejectHeaders = {"Goods ID", "Comment", "Review Date"};

            for (int i = 0; i < rejectHeaders.length; i++) {
                rejectedHeader.createCell(i).setCellValue(rejectHeaders[i]);
            }

            rowIdx = 1;
            for (GoodsReview r : rejectedGoods) {
                Row row = rejectedSheet.createRow(rowIdx++);
                row.createCell(0).setCellValue(r.getGoods().getId());
                row.createCell(1).setCellValue(r.getComment());
                row.createCell(2).setCellValue(r.getReviewDate().toString());
            }

            workbook.write(out);
            return new ByteArrayInputStream(out.toByteArray());
        }
    }
}


---

5. ExcelReportController.java

package org.policy.controller;

import lombok.RequiredArgsConstructor;
import org.policy.service.ExcelReportService;
import org.springframework.core.io.InputStreamResource;
import org.springframework.http.HttpHeaders;
import org.springframework.http.MediaType;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

@RestController
@RequestMapping("/api/excel-report")
@RequiredArgsConstructor
public class ExcelReportController {

    private final ExcelReportService reportService;

    @GetMapping("/download")
    public ResponseEntity<InputStreamResource> downloadExcelReport() throws Exception {
        var stream = reportService.generateExcelReport();

        return ResponseEntity.ok()
                .header(HttpHeaders.CONTENT_DISPOSITION, "attachment; filename=report.xlsx")
                .contentType(MediaType.APPLICATION_OCTET_STREAM)
                .body(new InputStreamResource(stream));
    }
}


---

Liquibase ChangeSet for Inventory Table

Make sure this table exists if not created yet:

<changeSet id="create-inventory-table" author="admin">
    <createTable tableName="inventory">
        <column name="id" type="BIGINT" autoIncrement="true">
            <constraints primaryKey="true"/>
        </column>
        <column name="goods_id" type="BIGINT"/>
        <column name="quantity" type="INT"/>
        <column name="warehouse_location" type="VARCHAR(255)"/>
        <column name="date_added" type="DATE"/>
    </createTable>
    <addForeignKeyConstraint baseTableName="inventory"
                             baseColumnNames="goods_id"
                             referencedTableName="goods"
                             referencedColumnNames="id"
                             constraintName="fk_inventory_goods"/>
</changeSet>

Let me know if you want the frontend download button implementation as well.

